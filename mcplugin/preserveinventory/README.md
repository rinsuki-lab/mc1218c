# PreserveInventory

このプラグインは、プレーヤーが死んだ時に遺留品を自動で回収し、後々コストまたは「遺留品の記録」と引き換えに遺留品を受け取れるようになるプラグインです。

`keepInventory` ほどはぬるすぎず、何もしないバニラよりは易しめ、程度を目指しているプラグインです。

## 概要

このプラグインは `/preserveinventory on` で有効にできます (デフォルトで有効になっています)。無効にしたい (バニラのその場ドロップの挙動に戻したい) 場合は `/preserveinventory off` で無効化できます。

コマンドでプラグインを無効化しても、プレーヤーがまだ受け取っていない遺留品は引き続き後述の方法で受け取ることができます。

プレーヤーにとってプラグインが有効な時にプレーヤーが死ぬと、一部の例外を除いて遺留品が回収され、その場に代わりに「遺留品の記録」がドロップするようになります。

回収されてまだあなたが受け取っていない遺留品は `/preserveinventory list` コマンドで確認でき、コスト分のアイテムを持った状態か、当該デスに紐付く「遺留品の記録」がインベントリにある状態で`[受け取る]` をクリックすると、遺留品を受け取ることができます。

### 遺留品が回収されない例外について

以下の場合、遺留品が回収されず、バニラと同じように死亡場所に持っていたアイテムがドロップされます。

* そのプレーヤーのプラグインが無効である
  * この場合、全ての遺留品が回収されず、バニラと同じように死亡場所にドロップされます。
* バニラで死んだ場合にその場にドロップせず消滅するアイテムである
  * <a href="https://ja.minecraft.wiki/w/%E6%B6%88%E6%BB%85%E3%81%AE%E5%91%AA%E3%81%84" target="_blank"><ruby>消滅の呪い<rt>Curse of Vanishing</rt></ruby></a> エンチャントが付与されているアイテムを持っている場合、そのアイテムは遺留品として回収されず、かつその場にドロップもせず消滅します (それ以外の所持品は遺留品として回収されます)。
* (まだ未実装) 遺留品の回収上限に達している
  * 遺留品の回収枠は1プレーヤーあたり10死亡枠で、**10枠が埋まった状態で死亡した場合は遺留品が回収されません** (遺留品の個数は関係なく、枠数で判断されます)。
  * (まだ未実装) 遺留品の残り回収枠はリスポーン時・ログイン時にメッセージとして表示されます。早めの受け取りをお願いします。
* 遺留品のコスト (後述) が0である
  * 後述する遺留品のコストの合計が0である場合、遺留品は回収されず、全てのアイテムがその場にドロップされます。

## 遺留品のコスト

特定のアイテムが遺留品として回収された場合、そのデスには一定の回収コストが設定され、そのコストを支払うか、当該デスの「遺留品の記録」を回収することで、遺留品を受け取ることができます。

コストとしてカウントされるアイテムは以下の通りです。

* 鉄インゴット (各アイテムにつき1個)
  * 鉄の防具
  * 鉄ツール・剣
  * 鉄の馬鎧
  * 盾
* ダイヤモンド (各アイテムにつき1個)
  * ダイヤの防具
  * ダイヤツール・剣
  * ダイヤの馬鎧
  * シュルカーボックス
  * エリトラ

なお、シュルカーボックスやバンドルの中にあるアイテムはコストとしてカウントされません。また、エンチャントの状態はコストに影響しません。

特例として、ダイヤモンドのコストが1以上の場合、鉄インゴット分のコストは0になります (払う必要があるのはダイヤモンド分のコストだけ)。

### コストの計算例

* 鉄のフル防具だけを持っていた場合
  * コストは鉄インゴット×4
* 鉄のフル防具と鉄の剣を持っていた場合
  * コストは鉄インゴット×5
* 鉄のフル防具とダイヤの剣を持っていた場合
  * コストはダイヤモンド×1
    * 本来は鉄インゴット×4のコストも存在しますが、上記の特例により、鉄インゴット分のコストは0になり、ダイヤモンド×1のみが要求されます

## 「遺留品の記録」

「遺留品の記録」は、遺留品が回収されたデスが起きた場所に、遺留品の代わりにドロップするアイテムです。

見た目は「[記入済みの本](https://ja.minecraft.wiki/w/%E8%A8%98%E5%85%A5%E6%B8%88%E3%81%BF%E3%81%AE%E6%9C%AC)」ですが、クラフトや村人との取引で利用することはできません。

また、溶岩や爆発などで消滅することはありません (が、奈落に落ちた場合はロストします)。

これをデスした本人が持っている状態で当該デスの遺留品を受け取ろうとすると、コストの代わりに「遺留品の記録」を消費して遺留品を受け取ることができます。

### (まだ未実装) 過払いコストの返還

既にコストを払って遺留品を受け取った後に、当該デスの「遺留品の記録」を持つと、コストとして払ったアイテムが返還され、「遺留品の記録」が消滅します。